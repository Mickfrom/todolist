# Render Deployment Guide - Combined Service

This guide explains how to deploy your full-stack Todo List application on Render as a single service.

## What Changed

Your deployment is now configured as a **single combined service** where:
- Express backend serves the React frontend (no CORS issues!)
- One URL for the entire application
- Simpler configuration and management

## Fixed Issues

1. **Bcrypt dependency**: Changed from `bcrypt` to `bcryptjs` (pure JavaScript, no native compilation needed)
2. **Combined deployment**: Updated `render.yaml` to build both frontend and backend in one service
3. **API URL**: Client now uses empty base URL (same origin) instead of separate backend URL

## Deployment Steps

### Option 1: Redeploy Existing Service

If you already have a service deployed:

1. **Install the correct dependencies locally**:
   ```bash
   cd server
   npm install
   ```

2. **Commit and push the changes**:
   ```bash
   git add .
   git commit -m "Fix deployment: combined service with bcryptjs"
   git push origin combined-deployment
   ```

3. **Trigger redeploy on Render**:
   - Go to your Render dashboard
   - Find your service
   - Click "Manual Deploy" → "Deploy latest commit"

### Option 2: Create New Service from Blueprint

If starting fresh or recreating:

1. **Commit and push changes** (if not already done):
   ```bash
   git add .
   git commit -m "Configure combined deployment for Render"
   git push origin combined-deployment
   ```

2. **Go to Render Dashboard**:
   - Visit https://dashboard.render.com/

3. **Create New Blueprint Instance**:
   - Click "Blueprints" → "New Blueprint Instance"
   - Connect your GitHub repository
   - Select the `combined-deployment` branch
   - Render will auto-detect the `render.yaml` file

4. **Review and Deploy**:
   - Service name: `todolist-fullstack`
   - Plan: Free (or Starter for persistent storage)
   - Click "Apply" to start deployment

## Accessing Your App

Once deployed, you'll get a single URL like:
```
https://todolist-fullstack.onrender.com
```

This URL serves both:
- Your React app (frontend)
- Your API endpoints at `/api/*`

## Environment Variables

The following are automatically configured:
- `NODE_ENV`: production
- `JWT_SECRET`: Auto-generated by Render
- `PORT`: 10000 (Render default)
- `DATABASE_PATH`: ./database/todolist.db

## Important Notes

### ⚠️ Data Persistence (Free Tier)

The free tier does NOT support persistent disks. Your SQLite database will be reset on:
- Each new deployment
- Service restarts
- Instance migrations

**To enable persistence**: Upgrade to Starter plan ($7/month) and uncomment the disk section in `render.yaml`.

### Build Process

The build happens in this order:
1. `cd client && npm install && npm run build` - Builds React app
2. `cd server && npm install` - Installs backend dependencies
3. React build output goes to `client/dist`
4. Express serves static files from `client/dist`

### Health Check

Render will monitor your service at: `GET /health`

The endpoint returns:
```json
{
  "status": "ok",
  "message": "Server is running"
}
```

## Troubleshooting

### Build Fails

**Check the build logs**:
- Go to your service dashboard
- Click on "Logs" tab
- Look for errors during the build phase

**Common issues**:
- Missing dependencies: Make sure both `client/package.json` and `server/package.json` have all required packages
- Node version mismatch: Render uses Node 20 by default

### Service Won't Start

**Check the runtime logs**:
- Look for "Server running on port" message
- Check for database initialization errors

**Common issues**:
- Database folder permissions
- Missing environment variables
- Port binding issues (use `process.env.PORT`)

### 503 Service Unavailable

This usually means:
- Build succeeded but service failed to start
- Service is taking too long to respond to health checks
- Check runtime logs for startup errors

## Testing Locally Before Deploy

Build and run the production setup locally:

```bash
# Build the frontend
cd client
npm install
npm run build
cd ..

# Start the backend (it will serve the built frontend)
cd server
npm install
npm start
```

Visit: http://localhost:5000

The server should serve your React app and handle API requests.

## Support

If deployment fails:
1. Check Render dashboard logs (Build & Deploy tabs)
2. Ensure all changes are committed and pushed
3. Verify `render.yaml` syntax is correct
4. Try manual deploy from Render dashboard

## Files Modified

- `render.yaml` - Combined deployment configuration
- `server/package.json` - Changed bcrypt → bcryptjs
- `client/.env.production` - Empty API URL for same-origin requests
